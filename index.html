<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aim on Pump</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script src="https://unpkg.com/@solana/spl-token@latest/lib/index.iife.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }
        header {
            background: #333;
            color: #fff;
            padding: 1rem;
            text-align: center;
        }
        nav {
            background: #444;
            padding: 1rem;
        }
        nav a {
            color: #fff;
            margin: 0 1rem;
            text-decoration: none;
        }
        nav a:hover {
            text-decoration: underline;
        }
        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
            padding-bottom: 100px; /* Ensure space for footer */
            min-height: calc(100vh - 200px); /* Allow scrolling */
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        button {
            padding: 0.5rem 1rem;
            background: #333;
            color: #fff;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background: #555;
        }
        input {
            padding: 0.5rem;
            font-size: 1rem;
        }
        footer {
            background: #333;
            color: #fff;
            text-align: center;
            padding: 1rem;
            position: relative;
            width: 100%;
        }
        @media (max-width: 600px) {
            nav a {
                display: block;
                margin: 0.5rem 0;
            }
        }
        #gameCanvas {
            border: 1px solid #333;
            background: #f0f0f0;
            cursor: crosshair;
        }
        #gameInfo, #leaderboard {
            margin-top: 1rem;
        }
        #usernameSection {
            margin-bottom: 1rem;
        }
        #usernameInput {
            width: 150px;
            margin-right: 0.5rem;
        }
        #walletSection {
            margin-bottom: 1rem;
            padding: 1rem;
            border: 1px solid #333;
            border-radius: 5px;
            background: #f9f9f9;
        }
        #walletAddressInput {
            width: 300px;
            margin-right: 0.5rem;
        }
        #tokenBalance {
            font-weight: bold;
            color: #00ff00;
        }
        #leaderboardTable {
            width: 100%;
            max-width: 500px;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        #leaderboardTable th, #leaderboardTable td {
            border: 1px solid #333;
            padding: 0.5rem;
            text-align: left;
        }
        #leaderboardTable th {
            background: #444;
            color: #fff;
        }
        .countdown {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: #ff00ff; /* Neon pink for Y2K vibe */
            background: #000;
            padding: 0.5rem 1rem;
            border: 2px solid #00ff00; /* Neon green border */
            border-radius: 5px;
            text-align: center;
            margin: 1rem 0;
            text-shadow: 0 0 5px #ff00ff, 0 0 10px #00ff00; /* Glow effect */
            box-shadow: 0 0 10px #ff00ff;
        }
    </style>
</head>
<body>
    <header>
        <h1>Aim on Pump</h1>
    </header>
    <nav>
        <a href="#home" onclick="showSection('home')">Home</a>
        <a href="#about" onclick="showSection('about')">AimOnPump</a>
        <a href="#game" onclick="showSection('game')">Game</a>
    </nav>
    <div class="container">
        <div id="home" class="section active">
            <h2>Welcome</h2>
            <p>Easy to play game tied to an easy to buy token on pump.fun, leaderboard for game on same page as the game. <a href="https://pump.fun/coin/Cha8KT6YaskftXfiSeUqGQsqKeoFU6nhqzwQsLJXpump">Buy $aimpump</a>. Only holders of the coin can get airdrops from leaderboard wins.</p>
        </div>
        <div id="about" class="section">
            <h2>AimOnPump</h2>
            <p>AimOnPump is an easy user friendly website connected to $aimpump. The top 25 users on the leaderboard every 24 hours will get an airdrop of the token, amount based on position on leaderboard and MC of coin at the time. Community can vote on these percentages once we have gotten things going.</p>
            <div id="aboutCountdown" class="countdown">Airdrop in: 24:00:00</div>
        </div>
        <div id="game" class="section">
            <h2>Click the Target Game</h2>
            <div id="usernameSection">
                <p>Enter your username to play:</p>
                <input type="text" id="usernameInput" placeholder="Your Username" maxlength="20" required>
                <button id="submitUsername">Submit</button>
            </div>
            <div id="walletSection">
                <p>Connect your Solana wallet to check $aimpump holdings (required for airdrops):</p>
                <button id="connectWallet">Connect Wallet</button>
                <p>Or paste wallet address: <input type="text" id="walletAddressInput" placeholder="Enter Solana address"></p>
                <button id="checkManualWallet">Check Holdings</button>
                <p id="tokenBalance"></p>
            </div>
            <p>Click the red target to score points before the 30-second timer runs out!</p>
            <div id="gameCountdown" class="countdown">Airdrop in: 24:00:00</div>
            <canvas id="gameCanvas" width="500" height="300"></canvas>
            <p id="gameInfo">Score: 0 | Time: 30s</p>
            <button id="startGameButton" disabled>Start Game</button>
            <h3>Leaderboard (Top 25)</h3>
            <table id="leaderboardTable">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Username</th>
                        <th>Score</th>
                    </tr>
                </thead>
                <tbody id="leaderboardBody"></tbody>
            </table>
        </div>
    </div>
    <footer>
        <p>&copy; 2025 Aim on Pump. All rights reserved.</p>
    </footer>
    <script>
        // Temporary USDC mint for testing; REPLACE with your $aimpump mint address (44 characters) from pump.fun
        const TOKEN_MINT = 'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v';
        const TOKEN_DECIMALS = 6; // USDC uses 6 decimals; confirm $aimpump decimals on pump.fun or Solana Explorer

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            if (sectionId === 'game') {
                initGame();
            }
        }

        // Countdown Timer Logic
        function startCountdown() {
            const aboutCountdown = document.getElementById('aboutCountdown');
            const gameCountdown = document.getElementById('gameCountdown');
            const oneDayInMs = 24 * 60 * 60 * 1000; // 24 hours in milliseconds

            let startTime = localStorage.getItem('countdownStart');
            if (!startTime) {
                startTime = Date.now();
                localStorage.setItem('countdownStart', startTime);
            }
            startTime = parseInt(startTime);

            function updateTimer() {
                const now = Date.now();
                const elapsed = now - startTime;
                const timeLeft = Math.max(0, oneDayInMs - (elapsed % oneDayInMs));
                if (timeLeft === 0) {
                    startTime = now;
                    localStorage.setItem('countdownStart', startTime);
                }
                const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                const timeString = `Airdrop in: ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                if (aboutCountdown) aboutCountdown.textContent = timeString;
                if (gameCountdown) gameCountdown.textContent = timeString;
            }

            updateTimer();
            setInterval(updateTimer, 1000);
        }

        // Wallet Scanner Logic
        let walletPublicKey = null;
        let tokenBalance = 0;

        async function connectWallet() {
            const tokenBalanceElement = document.getElementById('tokenBalance');
            tokenBalanceElement.textContent = 'Connecting...';
            if ('solana' in window) {
                try {
                    const response = await window.solana.connect();
                    walletPublicKey = response.publicKey.toString();
                    document.getElementById('connectWallet').textContent = `Connected: ${walletPublicKey.slice(0, 4)}...${walletPublicKey.slice(-4)}`;
                    console.log('Connected wallet:', walletPublicKey);
                    await checkTokenBalance(walletPublicKey);
                } catch (err) {
                    console.error('Wallet connection failed:', err.message);
                    tokenBalanceElement.textContent = 'Failed to connect wallet. Try again.';
                }
            } else {
                tokenBalanceElement.textContent = 'Solana wallet not found! Install Phantom or Solflare.';
                alert('Please install a Solana wallet like Phantom or Solflare.');
            }
        }

        async function checkManualWallet() {
            const tokenBalanceElement = document.getElementById('tokenBalance');
            const address = document.getElementById('walletAddressInput').value.trim();
            if (!address) {
                tokenBalanceElement.textContent = 'Enter a wallet address.';
                return;
            }
            try {
                const publicKey = new window.solanaWeb3.PublicKey(address);
                if (!window.solanaWeb3.PublicKey.isOnCurve(publicKey.toBuffer())) {
                    tokenBalanceElement.textContent = 'Invalid Solana address.';
                    console.log('Invalid address provided:', address);
                    return;
                }
                walletPublicKey = address;
                tokenBalanceElement.textContent = 'Checking balance...';
                console.log('Checking balance for:', walletPublicKey);
                await checkTokenBalance(address);
            } catch (err) {
                console.error('Invalid address:', err.message);
                tokenBalanceElement.textContent = 'Invalid Solana address.';
            }
        }

        async function checkTokenBalance(address) {
            const tokenBalanceElement = document.getElementById('tokenBalance');
            try {
                // Replace with QuickNode endpoint for reliability (get free tier at quicknode.com)
                const connection = new window.solanaWeb3.Connection('https://api.mainnet-beta.solana.com', 'confirmed');
                console.log('Connecting to RPC:', connection.rpcEndpoint);
                let mintPublicKey;
                try {
                    mintPublicKey = new window.solanaWeb3.PublicKey(TOKEN_MINT);
                    console.log('Mint address:', TOKEN_MINT);
                } catch (err) {
                    console.error('Invalid mint address:', err.message);
                    tokenBalanceElement.textContent = 'Error: Invalid token mint address. Contact support.';
                    return;
                }
                const ownerPublicKey = new window.solanaWeb3.PublicKey(address);
                console.log('Owner address:', address);
                const tokenAccountPublicKey = window.splToken.getAssociatedTokenAddressSync(mintPublicKey, ownerPublicKey);
                console.log('ATA:', tokenAccountPublicKey.toString());

                const tokenAccountInfo = await connection.getAccountInfo(tokenAccountPublicKey);
                if (!tokenAccountInfo) {
                    tokenBalance = 0;
                    tokenBalanceElement.textContent = 'Holdings: 0 $aimpump (Not eligible for airdrop)';
                    console.log('No ATA found for this wallet and mint.');
                    return;
                }

                const tokenAccount = await window.splToken.getAccount(connection, tokenAccountPublicKey, 'confirmed');
                console.log('Token account data:', tokenAccount);
                tokenBalance = Number(tokenAccount.amount) / Math.pow(10, TOKEN_DECIMALS); // Convert from lamports
                tokenBalanceElement.textContent = `Holdings: ${tokenBalance} $aimpump (Eligible for airdrop!)`;
                console.log('Balance retrieved:', tokenBalance);
                if (tokenBalance > 0 && username) {
                    document.getElementById('startGameButton').disabled = false;
                }
            } catch (err) {
                console.error('Balance check failed:', err.message);
                tokenBalanceElement.textContent = `Error checking holdings: ${err.message}. Try again or use a different RPC.`;
            }
        }

        // Game Logic
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startButton = document.getElementById('startGameButton');
        const gameInfo = document.getElementById('gameInfo');
        const usernameInput = document.getElementById('usernameInput');
        const submitUsernameButton = document.getElementById('submitUsername');
        const usernameSection = document.getElementById('usernameSection');
        const leaderboardBody = document.getElementById('leaderboardBody');
        let score = 0;
        let timeLeft = 30;
        let gameActive = false;
        let target = { x: 0, y: 0, radius: 20 };
        let gameInterval;
        let username = '';

        function initGame() {
            username = localStorage.getItem('username') || '';
            if (username) {
                usernameSection.style.display = 'none';
                startButton.disabled = tokenBalance === 0;
                gameInfo.textContent = `Score: ${score} | Time: ${timeLeft}s | Player: ${username}`;
            } else {
                usernameSection.style.display = 'block';
                startButton.disabled = true;
                gameInfo.textContent = 'Enter a username to start playing.';
            }
            resetGame();
            updateLeaderboard();
        }

        function saveUsername() {
            username = usernameInput.value.trim();
            if (username) {
                localStorage.setItem('username', username);
                usernameSection.style.display = 'none';
                startButton.disabled = tokenBalance === 0;
                gameInfo.textContent = `Score: ${score} | Time: ${timeLeft}s | Player: ${username}`;
            } else {
                gameInfo.textContent = 'Please enter a valid username.';
            }
        }

        function resetGame() {
            score = 0;
            timeLeft = 30;
            gameActive = false;
            clearInterval(gameInterval);
            gameInfo.textContent = `Score: ${score} | Time: ${timeLeft}s | Player: ${username}`;
            startButton.textContent = 'Start Game';
            startButton.disabled = !username || tokenBalance === 0;
            clearCanvas();
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function drawTarget() {
            clearCanvas();
            ctx.beginPath();
            ctx.arc(target.x, target.y, target.radius, 0, Math.PI * 2);
            ctx.fillStyle = 'red';
            ctx.fill();
            ctx.closePath();
        }

        function moveTarget() {
            target.x = Math.random() * (canvas.width - 2 * target.radius) + target.radius;
            target.y = Math.random() * (canvas.height - 2 * target.radius) + target.radius;
            drawTarget();
        }

        function startGame() {
            if (gameActive || !username || tokenBalance === 0) return;
            gameActive = true;
            score = 0;
            timeLeft = 30;
            gameInfo.textContent = `Score: ${score} | Time: ${timeLeft}s | Player: ${username}`;
            startButton.textContent = 'Game Running';
            startButton.disabled = true;
            moveTarget();
            gameInterval = setInterval(() => {
                timeLeft--;
                gameInfo.textContent = `Score: ${score} | Time: ${timeLeft}s | Player: ${username}`;
                if (timeLeft <= 0) {
                    gameActive = false;
                    clearInterval(gameInterval);
                    if (tokenBalance > 0) saveScore();
                    gameInfo.textContent = `Game Over! Final Score: ${score} | Player: ${username}`;
                    startButton.textContent = 'Restart Game';
                    startButton.disabled = false;
                    clearCanvas();
                    updateLeaderboard();
                }
            }, 1000);
        }

        function saveScore() {
            let scores = JSON.parse(localStorage.getItem('scores') || '[]');
            scores.push({ username, score });
            scores.sort((a, b) => b.score - a.score);
            scores = scores.slice(0, 25);
            localStorage.setItem('scores', JSON.stringify(scores));
        }

        function updateLeaderboard() {
            const scores = JSON.parse(localStorage.getItem('scores') || '[]');
            leaderboardBody.innerHTML = '';
            scores.forEach((entry, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${index + 1}</td><td>${entry.username}</td><td>${entry.score}</td>`;
                leaderboardBody.appendChild(row);
            });
        }

        canvas.addEventListener('click', (e) => {
            if (!gameActive) return;
            const rect = canvas.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const clickY = e.clientY - rect.top;
            const distance = Math.sqrt((clickX - target.x) ** 2 + (clickY - target.y) ** 2);
            if (distance <= target.radius) {
                score++;
                gameInfo.textContent = `Score: ${score} | Time: ${timeLeft}s | Player: ${username}`;
                moveTarget();
            }
        });

        // Event Listeners
        startButton.addEventListener('click', startGame);
        submitUsernameButton.addEventListener('click', saveUsername);
        usernameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                saveUsername();
            }
        });
        document.getElementById('connectWallet').addEventListener('click', connectWallet);
        document.getElementById('checkManualWallet').addEventListener('click', checkManualWallet);

        // Start countdown timer
        startCountdown();

        // Show home section by default
        showSection('home');
    </script>
</body>
</html>
